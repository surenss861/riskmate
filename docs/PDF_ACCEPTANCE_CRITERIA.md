# PDF Executive Brief Acceptance Criteria

## Ship Gate Requirements

### ✅ PDF Validity
- Always returns a valid PDF (`%PDF-` header, ends with `%%EOF`)
- Minimum size: > 5 KB (ensures not a placeholder)
- Valid PDF structure (can be opened by standard PDF readers)

### ✅ Page Count Rules
- **Default**: 2 pages (cover + content)
- **With appendix**: 3-4 pages maximum
- **Appendix pages only added when**:
  - ≥3 top risk drivers, OR
  - ≥3 high-risk jobs, OR
  - ≥3 incidents
- No phantom/blank/footer-only pages

### ✅ Layout Quality
- No ugly text wrapping ("Recommende d" etc.)
- Fixed column widths prevent wrapping
- All text properly sanitized (no control characters)
- Consistent spacing (8pt grid system)

### ✅ Copy Quality
- Proper pluralization ("1 incident" vs "2 incidents")
- No truncated strings (measure text, clamp with "...")
- Grammar and punctuation correct
- All placeholders replaced with actual data or "—"

### ✅ Report Verification
- `reportId` embedded in footer/metadata
- `completed_hash` exists and matches generated bytes hash
- Verify endpoint `/api/executive/brief/[reportId]` returns metadata
- Audit trail in `report_runs` table

### ✅ Caching & Freshness
- No caching weirdness (fresh report every request)
- `revalidate = 0` in route config
- `Cache-Control: no-store` headers
- Build stamp in footer for verification

## Appendix Gating Rules

Appendix sections (Top Drivers, High-Risk Jobs, Incidents) should only render if:
- **Top Drivers**: ≥3 drivers available
- **High-Risk Jobs**: ≥3 high-risk jobs
- **Incidents**: ≥3 incidents

If content doesn't meet threshold, show inline note on page 1:
- "Appendix omitted (insufficient data in selected window)"

## Page Count Predictability

| Scenario | Expected Pages |
|----------|---------------|
| Minimal data (no appendix) | 2 |
| With 1 appendix section | 3 |
| With 2+ appendix sections | 3-4 |
| Maximum (all sections + large tables) | 4-5 |

## Visual Standards

- **Spacing**: 8pt grid system (8, 16, 24, 32, 40, 48)
- **Section structure**: Header → Divider → 12-16px gap → Content
- **Typography**: Consistent font sizes (h1: 32pt, h2: 22pt, body: 11pt)
- **Colors**: Brand-accurate palette (accent blue, proper grays)
- **Footer**: Appears on every page with build stamp

